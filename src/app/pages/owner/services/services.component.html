<div class="dashboard-wrapper">
  
  <!-- Animated Background Elements -->
  <div class="background-shapes">
    <span class="shape shape-1"></span>
    <span class="shape shape-2"></span>
    <span class="shape shape-3"></span>
  </div>

  <div class="dashboard-container">
    
    <!-- Page Header -->
    <div class="dashboard-header">
      <div class="header-content">
        <h2 class="dashboard-title">Salon Services</h2>
        <p class="dashboard-subtitle">Manage your salon services and pricing</p>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>Loading services...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && services.length === 0" class="empty-state">
      <div class="empty-icon">üíá‚Äç‚ôÄÔ∏è</div>
      <h4>No Services Yet</h4>
      <p>Add your first service to start offering salon treatments</p>
      <button 
        (click)="openModal(false)" 
        class="empty-action-btn"
      >
        Add First Service
      </button>
    </div>

    <!-- Services Table Section -->
    <div *ngIf="!loading && services.length > 0" class="table-section">
      
      <div class="section-header">
        <div>
          <h3 class="section-title">All Services</h3>
          <p class="section-subtitle">
            Showing {{ getShowingFrom() }} to {{ getShowingTo() }} of {{ totalItems }} service{{ totalItems !== 1 ? 's' : '' }}
          </p>
        </div>
        <button class="view-all-btn" (click)="openModal(false)">
          <span>Add New</span>
          <span class="arrow">‚Üí</span>
        </button>
      </div>

      <!-- Table -->
      <div class="table-container">
        <table class="modern-table">
          <thead>
            <tr>
              <th>
                <span class="th-content">
                  <span class="th-icon">üíá‚Äç‚ôÄÔ∏è</span>
                  Service Name
                </span>
              </th>
              <th>
                <span class="th-content">
                  <span class="th-icon">‚è±Ô∏è</span>
                  Duration
                </span>
              </th>
              <th>
                <span class="th-content">
                  <span class="th-icon">üí∞</span>
                  Price
                </span>
              </th>
              <th>
                <span class="th-content">
                  <span class="th-icon">üìç</span>
                  Locations
                </span>
              </th>
              <th>
                <span class="th-content">
                  <span class="th-icon">‚öôÔ∏è</span>
                  Actions
                </span>
              </th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let item of services; let i = index" 
                class="table-row"
                [style.animation-delay]="(i * 0.1) + 's'">
              
              <td>
                <div class="service-name">
                  <div class="service-avatar">
                    {{ getServiceInitial(item.name) }}
                  </div>
                  <span class="font-medium">{{ item.name }}</span>
                </div>
              </td>

              <td>
                <div class="duration-display">
                  <span class="duration-text">{{ getFormattedDuration(item.durationMinutes) }}</span>
                  <span class="duration-minutes">({{ item.durationMinutes }} mins)</span>
                </div>
              </td>

              <td>
                <span class="price-text">‚Çπ{{ item.price }}</span>
              </td>

              <td>
                <span class="location-text">{{ getLocationNames(item) }}</span>
              </td>

              <td>
                <div class="actions">
                  <button 
                    class="action-btn edit-btn"
                    (click)="openModal(true, item)"
                  >
                    <span class="icon">‚úèÔ∏è</span>
                    <span>Edit</span>
                  </button>
                  <button 
                    class="action-btn delete-btn"
                    (click)="openDeleteModal(item)"
                  >
                    <span class="icon">üóëÔ∏è</span>
                    <span>Delete</span>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="pagination-section">
        <div class="pagination-info">
          <span>Page {{ currentPage }} of {{ totalPages }}</span>
        </div>
        <div class="pagination-controls">
          <button 
            class="pag-btn" 
            (click)="changePage(currentPage - 1)"
            [disabled]="currentPage === 1"
          >
            <span>‚Äπ Previous</span>
          </button>
          <button 
            *ngFor="let page of getVisiblePages()"
            class="pag-btn"
            [class.active]="page === currentPage"
            (click)="changePage(page)"
          >
            {{ page }}
          </button>
          <button 
            class="pag-btn" 
            (click)="changePage(currentPage + 1)"
            [disabled]="currentPage === totalPages"
          >
            <span>Next ‚Ä∫</span>
          </button>
        </div>
      </div>

    </div>

  </div>

  <!-- Add/Edit Modal -->
  <div 
    *ngIf="showModal" 
    class="modal-overlay"
    (click)="closeModal()"
  >
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">
          {{ isEditing ? 'Edit Service' : 'Add New Service' }}
        </h3>
        <button class="close-btn" (click)="closeModal()">
          <span>√ó</span>
        </button>
      </div>

      <div class="modal-body">
        <form (ngSubmit)="saveService()" #serviceForm="ngForm">
          
          <!-- Service Name -->
          <div class="form-group">
            <label class="form-label">
              <span class="label-icon">‚úÇÔ∏è</span>
              Service Name
            </label>
            <input 
              type="text" 
              [(ngModel)]="form.name" 
              name="name"
              class="form-input"
              placeholder="e.g., Women's Haircut, Hair Coloring, Manicure"
              required
            />
            <small class="help-text">Enter the name of the service you offer</small>
          </div>

          <!-- Duration -->
          <div class="form-group">
            <label class="form-label">
              <span class="label-icon">‚è±Ô∏è</span>
              Service Duration
            </label>
            <input 
              type="number" 
              [(ngModel)]="form.durationMinutes" 
              name="durationMinutes"
              class="form-input"
              placeholder="Enter duration in minutes (e.g., 30, 60, 90)"
              required
              min="1"
              max="480"
            />
            
            <!-- Duration Display -->
            <div class="duration-info-box" *ngIf="form.durationMinutes > 0">
              <div class="duration-badge">
                <span class="badge-icon">üïê</span>
                <span class="badge-text">{{ getFormattedDuration(form.durationMinutes) }}</span>
              </div>
              <p class="duration-helper">{{ getDurationHelperText(form.durationMinutes) }}</p>
            </div>
            
            <small class="help-text" *ngIf="!form.durationMinutes || form.durationMinutes <= 0">
              How long does this service typically take?
            </small>
          </div>

          <!-- Price -->
          <div class="form-group">
            <label class="form-label">
              <span class="label-icon">üí∞</span>
              Service Price
            </label>
            <div class="price-input-wrapper">
              <span class="currency-symbol">‚Çπ</span>
              <input 
                type="number" 
                [(ngModel)]="form.price" 
                name="price"
                class="form-input price-input"
                placeholder="Enter price (e.g., 500, 1500)"
                required
                min="0"
              />
            </div>
            <small class="help-text">Set the price customers will pay for this service</small>
          </div>

          <!-- Locations -->
          <div class="form-group">
            <label class="form-label">
              <span class="label-icon">üìç</span>
              Available at Branches
            </label>
            
            <!-- Selected Locations Chips -->
            <div class="selected-chips" *ngIf="selectedLocations.length > 0">
              <div class="location-chip" *ngFor="let loc of selectedLocations">
                <span class="chip-icon">üìç</span>
                <span class="chip-text">{{ loc.name }}</span>
                <button 
                  type="button" 
                  class="chip-remove" 
                  (click)="removeLocation(loc._id)"
                  title="Remove location"
                >
                  √ó
                </button>
              </div>
            </div>

            <!-- Dropdown for Available Locations -->
            <select 
              class="form-input location-select"
              (change)="addLocation($event)"
              [value]="''"
            >
              <option value="" disabled>
                {{ availableLocations.length > 0 ? '‚ûï Click to add another branch...' : '‚úì All branches selected' }}
              </option>
              <option 
                *ngFor="let loc of availableLocations" 
                [value]="loc._id"
              >
                üìç {{ loc.name }}
              </option>
            </select>

            <small class="help-text" *ngIf="selectedLocations.length === 0">
              ‚ö†Ô∏è Please select at least one branch where this service is available
            </small>
            <small class="help-text success" *ngIf="selectedLocations.length > 0">
              ‚úì Service available at {{ selectedLocations.length }} branch{{ selectedLocations.length !== 1 ? 'es' : '' }}
            </small>
          </div>

        </form>
      </div>

      <div class="modal-footer">
        <button 
          (click)="closeModal()" 
          class="btn btn-secondary"
        >
          Cancel
        </button>

        <button 
          (click)="saveService()" 
          class="btn btn-primary"
          [disabled]="!form.name || !form.durationMinutes || !form.price || selectedLocations.length === 0"
        >
          <span class="btn-icon">{{ isEditing ? '‚úì' : '‚ûï' }}</span>
          {{ isEditing ? 'Update Service' : 'Add Service' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Notification Modal -->
  <div 
    *ngIf="showNotificationModal" 
    class="modal-overlay"
    (click)="closeNotification()"
  >
    <div class="modal-content notification-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">{{ notification.title }}</h3>
        <button class="close-btn" (click)="closeNotification()">
          <span>√ó</span>
        </button>
      </div>

      <div class="modal-body">
        <p>{{ notification.message }}</p>
      </div>

      <div class="modal-footer">
        <button 
          (click)="closeNotification()" 
          class="btn btn-primary"
        >
          OK
        </button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div 
    *ngIf="showDeleteModal" 
    class="modal-overlay"
    (click)="closeDeleteModal()"
  >
    <div class="modal-content delete-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">
          <span class="warning-icon">‚ö†Ô∏è</span>
          Confirm Delete
        </h3>
        <button class="close-btn" (click)="closeDeleteModal()">
          <span>√ó</span>
        </button>
      </div>

      <div class="modal-body">
        <p>Are you sure you want to delete the service "<strong>{{ selectedService?.name }}</strong>"?</p>
        <div class="warning-box">
          <span class="warning-icon-sm">üóëÔ∏è</span>
          <span>This action cannot be undone. The service will be permanently deleted.</span>
        </div>
      </div>

      <div class="modal-footer">
        <button 
          (click)="closeDeleteModal()" 
          class="btn btn-secondary"
        >
          Cancel
        </button>
        <button 
          (click)="confirmDelete()" 
          class="btn btn-danger"
        >
          <span class="btn-icon">üóëÔ∏è</span>
          Delete Service
        </button>
      </div>
    </div>
  </div>

</div>