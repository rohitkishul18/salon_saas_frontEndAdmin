<div class="dashboard-wrapper">
  
  <!-- Animated Background Elements -->
  <div class="background-shapes">
    <span class="shape shape-1"></span>
    <span class="shape shape-2"></span>
    <span class="shape shape-3"></span>
  </div>

  <div class="dashboard-container">
    
    <!-- Page Header -->
    <div class="dashboard-header">
      <div class="header-content">
        <h2 class="dashboard-title">Customer Bookings</h2>
        <p class="dashboard-subtitle">Manage all your salon appointments and bookings</p>
      </div>
      <button class="refresh-btn" (click)="loadBookings()" [disabled]="loading">
        <span class="refresh-icon" [class.spinning]="loading">üîÑ</span>
        <span>Refresh</span>
      </button>
    </div>

    <!-- Global Error Message -->
    <div class="error-banner" *ngIf="errorMessage && !loading">
      <div class="error-content">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <span>{{ errorMessage }}</span>
      </div>
      <div class="error-actions">
        <button class="retry-btn" (click)="retryLoad()">Retry</button>
        <button class="dismiss-btn" (click)="clearError()">√ó</button>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>Loading bookings...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && bookings.length === 0 && !errorMessage" class="empty-state">
      <div class="empty-icon">üìÖ</div>
      <h4>No Bookings Yet</h4>
      <p>Your booking history will appear here once customers start scheduling</p>
    </div>

    <!-- Bookings Table Section -->
    <div *ngIf="!loading && bookings.length > 0" class="table-section">
      
      <div class="section-header">
        <div>
          <h3 class="section-title">All Bookings</h3>
          <p class="section-subtitle">
            Showing {{ getShowingFrom() }} to {{ getShowingTo() }} of {{ totalItems }} booking{{ totalItems !== 1 ? 's' : '' }}
          </p>
        </div>
      </div>

      <!-- Table -->
      <div class="table-container">
        <table class="modern-table">
          <thead>
            <tr>
              <th>
                <span class="th-content">
                  <span class="th-icon">üë§</span>
                  Customer
                </span>
              </th>
              <th>
                <span class="th-content">
                  <span class="th-icon">üìû</span>
                  Phone
                </span>
              </th>
              <th>
                <span class="th-content">
                  <span class="th-icon">üè¢</span>
                  Branch
                </span>
              </th>
              <th>
                <span class="th-content">
                  <span class="th-icon">üíá‚Äç‚ôÄÔ∏è</span>
                  Service
                </span>
              </th>
              <th>
                <span class="th-content">
                  <span class="th-icon">üìÖ</span>
                  Date
                </span>
              </th>
              <th>
                <span class="th-content">
                  <span class="th-icon">üïí</span>
                  Time
                </span>
              </th>
              <th>
                <span class="th-content">
                  <span class="th-icon">üí∞</span>
                  Amount
                </span>
              </th>
              <th>
                <span class="th-content">
                  <span class="th-icon">üìä</span>
                  Status
                </span>
              </th>
              <th>
                <span class="th-content">
                  <span class="th-icon">‚öôÔ∏è</span>
                  Actions
                </span>
              </th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let b of bookings; let i = index" 
                class="table-row"
                [style.animation-delay]="(i * 0.1) + 's'">
              
              <td>
                <div class="customer-name">
                  <div class="customer-avatar">
                    {{ getCustomerInitial(b.customerName) }}
                  </div>
                  <span class="font-medium">{{ b.customerName }}</span>
                </div>
              </td>

              <td>
                <span class="phone-text">{{ b.customerPhone }}</span>
              </td>

              <td>
                <div class="branch-info">
                  <span class="branch-badge">{{ getBranchName(b) }}</span>
                </div>
              </td>

              <td>
                <span class="service-text">{{ getServiceTitle(b) }}</span>
              </td>

              <td>
                <span class="date-text">{{ b.scheduledAt | date:'MMM d, y' }}</span>
              </td>

              <td>
                <span class="time-text">{{ b.scheduledAt | date:'shortTime' }}</span>
              </td>

              <td>
                <span class="amount-text">‚Çπ{{ getServicePrice(b) }}</span>
              </td>

              <td>
                <span class="status-badge" 
                      [ngClass]="{
                        'status-pending': b.status === 'pending',
                        'status-confirmed': b.status === 'confirmed',
                        'status-cancelled': b.status === 'cancelled',
                        'status-done': b.status === 'done'
                      }">
                  {{ b.status | titlecase }}
                </span>
              </td>

              <td>
                <div class="actions">
                  <button 
                    class="action-btn view-btn"
                    (click)="viewDetails(b)"
                    title="View Details"
                  >
                    <span class="icon">üëÅÔ∏è</span>
                    <span>View</span>
                  </button>
                  <button 
                    class="action-btn status-btn"
                    (click)="openStatusModal(b)"
                    title="Change Status"
                  >
                    <span class="icon">üîÑ</span>
                    <span>Status</span>
                  </button>
                  <button 
                    class="action-btn delete-btn"
                    (click)="deleteBooking(b)"
                    title="Delete Booking"
                  >
                    <span class="icon">üóëÔ∏è</span>
                    <span>Delete</span>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="pagination-section">
        <div class="pagination-info">
          <span>Page {{ currentPage }} of {{ totalPages }}</span>
        </div>
        <div class="pagination-controls">
          <button 
            class="pag-btn" 
            (click)="changePage(currentPage - 1)"
            [disabled]="currentPage === 1"
          >
            <span>‚Äπ Previous</span>
          </button>
          <button 
            *ngFor="let page of getVisiblePages()"
            class="pag-btn"
            [class.active]="page === currentPage"
            (click)="changePage(page)"
          >
            {{ page }}
          </button>
          <button 
            class="pag-btn" 
            (click)="changePage(currentPage + 1)"
            [disabled]="currentPage === totalPages"
          >
            <span>Next ‚Ä∫</span>
          </button>
        </div>
      </div>

    </div>

  </div>

  <!-- Details Modal -->
  <div 
    *ngIf="showDetails" 
    class="modal-overlay"
    (click)="closeDetails()"
  >
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">Booking Details</h3>
        <button class="close-btn" (click)="closeDetails()">
          <span>√ó</span>
        </button>
      </div>

      <div class="modal-body">
        <div class="booking-details-grid">
          <div class="detail-item">
            <label>Customer Name</label>
            <p>{{ selected?.customerName }}</p>
          </div>
          <div class="detail-item">
            <label>Phone Number</label>
            <p>{{ selected?.customerPhone }}</p>
          </div>
          <div class="detail-item">
            <label>Branch Location</label>
            <p>{{ getBranchName(selected) }}</p>
          </div>
          <div class="detail-item">
            <label>Service</label>
            <p>{{ getServiceTitle(selected) }}</p>
          </div>
          <div class="detail-item">
            <label>Appointment Date</label>
            <p>{{ selected?.scheduledAt | date:'fullDate' }}</p>
          </div>
          <div class="detail-item">
            <label>Appointment Time</label>
            <p>{{ selected?.scheduledAt | date:'shortTime' }}</p>
          </div>
          <div class="detail-item">
            <label>Service Amount</label>
            <p class="amount-highlight">‚Çπ{{ getServicePrice(selected) }}</p>
          </div>
          <div class="detail-item">
            <label>Booking Status</label>
            <p>
              <span class="status-badge" 
                    [ngClass]="{
                      'status-pending': selected?.status === 'pending',
                      'status-confirmed': selected?.status === 'confirmed',
                      'status-cancelled': selected?.status === 'cancelled',
                      'status-done': selected?.status === 'done'
                    }">
                {{ selected?.status | titlecase }}
              </span>
            </p>
          </div>
          <div class="detail-item full-width" *ngIf="selected?.notes">
            <label>Notes</label>
            <p class="notes-text">{{ selected?.notes }}</p>
          </div>
          <div class="detail-item full-width">
            <label>Booked On</label>
            <p>{{ selected?.createdAt | date:'medium' }}</p>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button 
          (click)="closeDetails()" 
          class="btn btn-secondary"
        >
          Close
        </button>
      </div>
    </div>
  </div>

  <!-- Status Change Modal -->
  <div 
    *ngIf="showStatusModal" 
    class="modal-overlay"
    (click)="closeStatusModal()"
  >
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">Change Booking Status</h3>
        <button class="close-btn" (click)="closeStatusModal()">
          <span>√ó</span>
        </button>
      </div>

      <div class="modal-body">
        <!-- Error Message in Modal -->
        <div class="modal-error" *ngIf="errorMessage">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
          <span>{{ errorMessage }}</span>
        </div>

        <div class="booking-summary">
          <p><strong>Customer:</strong> {{ currentBooking?.customerName }}</p>
          <p><strong>Branch:</strong> {{ getBranchName(currentBooking) }}</p>
          <p><strong>Current Status:</strong> 
            <span class="status-badge" 
                  [ngClass]="{
                    'status-pending': currentBooking?.status === 'pending',
                    'status-confirmed': currentBooking?.status === 'confirmed',
                    'status-cancelled': currentBooking?.status === 'cancelled',
                    'status-done': currentBooking?.status === 'done'
                  }">
              {{ currentBooking?.status | titlecase }}
            </span>
          </p>
        </div>
        
        <div class="form-group">
          <label class="form-label">Select New Status</label>
          <select 
            [(ngModel)]="newStatus" 
            name="status"
            class="form-input"
            [disabled]="isUpdating"
            required
          >
            <option value="pending">‚è≥ Pending</option>
            <option value="confirmed">‚úÖ Confirmed</option>
            <option value="cancelled">‚ùå Cancelled</option>
            <option value="done">‚úîÔ∏è Done</option>
          </select>
        </div>
      </div>

      <div class="modal-footer">
        <button 
          (click)="closeStatusModal()" 
          class="btn btn-secondary"
          [disabled]="isUpdating"
        >
          Cancel
        </button>
        <button 
          (click)="updateStatus()" 
          class="btn btn-primary"
          [disabled]="newStatus === currentBooking?.status || isUpdating"
        >
          <span *ngIf="!isUpdating">Update Status</span>
          <span *ngIf="isUpdating" class="loading-text">
            <span class="mini-spinner"></span>
            Updating...
          </span>
        </button>
      </div>
    </div>
  </div>

</div>